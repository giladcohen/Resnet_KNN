import subprocess
import time
import os
import numpy as np

def run_cmd(cmd):
    # print ('start running command {} for i={}'.format(cmd, i))
    process = subprocess.call(cmd, shell=True)
    # print ('finished running command {} for i={}'.format(cmd, i))

# dump_file = '/data/gilad/logs/influence/cifar100/log_300419_b_125_wd_0.0004_mom_lr_0.1_f_0.9_p_3_c_2_val_size_1000_ls_0.01/test/dump.txt'
# with open(dump_file) as f:
#     content = f.readlines()
# # # you may also want to remove whitespace characters like `\n` at the end of each line
# content = [x.strip() for x in content]
# del content[0]
#
# dir_list = []
# for c in content:
#     dir_list.append(os.path.join('/data/gilad/logs/influence/cifar100/log_300419_b_125_wd_0.0004_mom_lr_0.1_f_0.9_p_3_c_2_val_size_1000_ls_0.01/test', c))
#
# for dir in dir_list:
#     cmd = 'mkdir -p ' + os.path.join(dir, 'adv', 'deepfool')
#     run_cmd(cmd)
#     cmd = 'mv ' + os.path.join(dir, 'adv', '*') + ' ' + os.path.join(dir, 'adv', 'deepfool')
#     run_cmd(cmd)

# home_dir = '/data/gilad/logs/influence/cifar10/log_080419_b_125_wd_0.0004_mom_lr_0.1_f_0.9_p_3_c_2_val_size_1000/val'
# for i in cifar10_val_inds:
#     adv_dir = os.path.join(home_dir, 'val_index_{}'.format(i), 'adv')
#     deepfool_dir = os.path.join(adv_dir, 'deepfool')
#     if not os.path.exists(deepfool_dir):  # path not exist
#         run_cmd('mkdir -p ' + deepfool_dir)
#         # go to dir
#         os.chdir(adv_dir)
#         run_cmd('mv `find . -type f | grep -v "/cw/"`' + ' deepfool/')
#     else:  # path exist
#         # check if empty
#         if len(os.listdir(deepfool_dir)) == 0:  # indeed empty
#             os.chdir(adv_dir)
#             run_cmd('mv `find . -type f | grep -v "/cw/"`' + ' deepfool/')

cifar10_val_inds = [  107,   127,   135,   150,   189,   255,   272,   292,   375,
         376,   385,   479,   512,   554,   730,   739,   760,   788,
         803,   810,   922,   971,  1136,  1219,  1258,  1285,  1347,
        1403,  1506,  1508,  1555,  1559,  1572,  1609,  1613,  1625,
        1661,  1723,  1788,  1820,  1877,  1949,  1956,  2001,  2012,
        2047,  2099,  2628,  2660,  2690,  2699,  2769,  2798,  2829,
        2860,  2890,  2893,  3073,  3080,  3095,  3111,  3128,  3182,
        3251,  3255,  3459,  3541,  3580,  3594,  3724,  3747,  3785,
        3794,  3807,  3844,  3892,  3990,  4053,  4067,  4273,  4417,
        4423,  4493,  4533,  4537,  4579,  4782,  4874,  4894,  4911,
        5103,  5110,  5148,  5204,  5215,  5276,  5280,  5303,  5359,
        5403,  5449,  5455,  5519,  5569,  5641,  5746,  5763,  5772,
        5806,  6009,  6124,  6157,  6176,  6204,  6206,  6265,  6308,
        6374,  6386,  6394,  6400,  6531,  6575,  6604,  6682,  6700,
        6763,  7033,  7059,  7080,  7091,  7127,  7139,  7179,  7236,
        7240,  7247,  7250,  7316,  7357,  7380,  7395,  7564,  7568,
        7634,  7671,  7696,  7828,  7830,  7940,  7973,  8099,  8133,
        8144,  8183,  8374,  8506,  8553,  8565,  8570,  8617,  8657,
        8661,  8692,  8783,  8828,  8862,  8912,  9054,  9082,  9110,
        9165,  9247,  9271,  9395,  9436,  9515,  9575,  9612,  9685,
        9712,  9716,  9721,  9729,  9784,  9853, 10021, 10159, 10251,
       10267, 10277, 10279, 10363, 10365, 10466, 10547, 10566, 10605,
       10716, 10736, 10769, 11003, 11017, 11021, 11056, 11205, 11211,
       11219, 11328, 11403, 11503, 11520, 11553, 11648, 11674, 11777,
       11809, 11854, 11882, 11925, 11968, 12024, 12094, 12120, 12191,
       12259, 12262, 12268, 12270, 12366, 12382, 12431, 12433, 12435,
       12628, 12636, 12675, 12684, 12701, 12705, 12747, 12748, 12809,
       12923, 12943, 13041, 13069, 13235, 13293, 13322, 13341, 13446,
       13504, 13555, 13590, 13613, 13628, 13634, 13639, 13653, 13678,
       13726, 13816, 13818, 13862, 13876, 13985, 14007, 14046, 14127,
       14132, 14135, 14137, 14153, 14168, 14211, 14279, 14283, 14311,
       14490, 14526, 14644, 14817, 14848, 14881, 15018, 15034, 15092,
       15166, 15169, 15270, 15275, 15292, 15314, 15331, 15361, 15391,
       15393, 15398, 15443, 15504, 15526, 15612, 15636, 15734, 15752,
       15806, 15837, 15860, 15862, 15931, 15957, 16019, 16021, 16025,
       16067, 16105, 16188, 16189, 16197, 16214, 16221, 16232, 16298,
       16438, 16503, 16513, 16533, 16547, 16551, 16598, 16713, 16715,
       16868, 16912, 17024, 17046, 17114, 17362, 17373, 17421, 17442,
       17478, 17487, 17504, 17515, 17569, 17691, 17904, 17945, 17975,
       18030, 18083, 18252, 18304, 18347, 18351, 18377, 18393, 18406,
       18409, 18417, 18542, 18586, 18622, 18690, 18801, 18879, 18890,
       18902, 18905, 18946, 18962, 19029, 19081, 19082, 19168, 19190,
       19239, 19330, 19343, 19482, 19487, 19489, 19590, 19603, 19631,
       19655, 19825, 19880, 19948, 19962, 19976, 19995, 19996, 20002,
       20069, 20108, 20132, 20174, 20206, 20212, 20246, 20263, 20336,
       20469, 20494, 20505, 20560, 20588, 20592, 20679, 20711, 20722,
       20746, 20800, 20809, 21038, 21051, 21055, 21169, 21188, 21246,
       21252, 21359, 21423, 21590, 21606, 21624, 21629, 21649, 21744,
       21813, 21835, 21848, 21883, 21894, 21980, 22000, 22001, 22017,
       22050, 22056, 22166, 22239, 22290, 22312, 22326, 22335, 22345,
       22391, 22423, 22498, 22653, 22713, 22784, 22792, 22855, 22886,
       22912, 22935, 22952, 23004, 23035, 23048, 23092, 23138, 23190,
       23194, 23212, 23289, 23305, 23468, 23517, 23534, 23535, 23541,
       23730, 23749, 23798, 23808, 23904, 24006, 24016, 24058, 24142,
       24198, 24221, 24225, 24247, 24361, 24366, 24385, 24393, 24487,
       24589, 24590, 24636, 24803, 24816, 24900, 24991, 25041, 25047,
       25067, 25101, 25108, 25201, 25227, 25230, 25272, 25397, 25401,
       25421, 25537, 25570, 25776, 25952, 26009, 26038, 26042, 26065,
       26075, 26088, 26097, 26120, 26229, 26389, 26452, 26612, 26722,
       26748, 26837, 26840, 26851, 26927, 26965, 26987, 26994, 27003,
       27009, 27082, 27113, 27239, 27251, 27255, 27340, 27347, 27516,
       27561, 27566, 27598, 27611, 27669, 27713, 27743, 27838, 27897,
       27943, 27966, 27995, 28077, 28079, 28110, 28163, 28166, 28181,
       28193, 28210, 28314, 28315, 28342, 28366, 28380, 28491, 28579,
       28649, 28653, 28660, 28721, 28730, 28750, 28835, 28898, 28910,
       28932, 28957, 29042, 29099, 29113, 29138, 29160, 29172, 29218,
       29226, 29274, 29320, 29342, 29363, 29398, 29543, 29587, 29623,
       29656, 29729, 29755, 29804, 29861, 29955, 29969, 30013, 30035,
       30406, 30532, 30549, 30557, 30640, 30656, 30700, 30771, 30832,
       30887, 30931, 30948, 31013, 31029, 31113, 31212, 31250, 31310,
       31324, 31381, 31397, 31445, 31448, 31530, 31536, 31554, 31567,
       31732, 31755, 31822, 31865, 31895, 31917, 31931, 31932, 31949,
       31965, 31987, 32024, 32053, 32107, 32112, 32185, 32277, 32317,
       32344, 32368, 32439, 32461, 32507, 32609, 32644, 32719, 32783,
       32811, 32843, 32846, 32942, 32971, 33016, 33055, 33122, 33149,
       33163, 33225, 33303, 33322, 33344, 33413, 33423, 33491, 33532,
       33541, 33566, 33572, 33833, 33838, 33841, 33870, 33961, 33971,
       33974, 34007, 34045, 34074, 34094, 34109, 34160, 34368, 34383,
       34399, 34477, 34489, 34531, 34633, 34642, 34818, 34843, 34970,
       35005, 35066, 35097, 35115, 35147, 35155, 35184, 35200, 35241,
       35396, 35399, 35437, 35465, 35515, 35564, 35766, 35795, 35820,
       35859, 36096, 36208, 36213, 36243, 36294, 36315, 36332, 36344,
       36345, 36348, 36365, 36382, 36511, 36521, 36707, 36841, 36888,
       36906, 36983, 37034, 37072, 37074, 37097, 37166, 37173, 37177,
       37332, 37339, 37342, 37428, 37619, 37643, 37724, 37733, 37756,
       37786, 37828, 37851, 37855, 37890, 38146, 38171, 38245, 38268,
       38269, 38301, 38313, 38372, 38385, 38431, 38467, 38530, 38645,
       38689, 38740, 38819, 38865, 38942, 38977, 38982, 39010, 39116,
       39145, 39165, 39184, 39297, 39302, 39398, 39558, 39639, 39737,
       39876, 40009, 40053, 40089, 40238, 40254, 40256, 40275, 40414,
       40517, 40704, 40786, 40832, 40898, 40899, 40932, 40964, 41012,
       41031, 41115, 41123, 41189, 41200, 41208, 41222, 41231, 41383,
       41491, 41528, 41568, 41584, 41672, 41690, 41901, 41953, 42041,
       42052, 42053, 42201, 42258, 42263, 42266, 42302, 42415, 42433,
       42506, 42511, 42597, 42628, 42672, 42696, 42707, 42709, 42733,
       42764, 42823, 42902, 42948, 42949, 43114, 43191, 43208, 43252,
       43256, 43309, 43374, 43383, 43405, 43438, 43495, 43528, 43692,
       43784, 43790, 43869, 43929, 43953, 44038, 44068, 44090, 44161,
       44165, 44207, 44273, 44319, 44354, 44381, 44397, 44458, 44612,
       44661, 44762, 44839, 44897, 44906, 44936, 45003, 45007, 45080,
       45085, 45112, 45238, 45295, 45315, 45368, 45405, 45426, 45567,
       45575, 45642, 45644, 45681, 45775, 45804, 45841, 45923, 45929,
       45974, 46018, 46039, 46151, 46156, 46216, 46267, 46299, 46393,
       46428, 46469, 46475, 46506, 46524, 46548, 46577, 46611, 46620,
       46663, 46682, 46691, 46739, 46771, 46853, 46854, 46871, 46893,
       46946, 47078, 47120, 47251, 47345, 47553, 47613, 47680, 47727,
       47732, 47769, 47831, 47834, 47837, 47856, 47953, 47999, 48063,
       48073, 48097, 48192, 48212, 48311, 48360, 48367, 48418, 48538,
       48562, 48623, 48642, 48738, 48756, 48765, 48774, 48799, 48998,
       49169, 49203, 49221, 49277, 49399, 49423, 49482, 49527, 49571,
       49575, 49676, 49772, 49776, 49781, 49863, 49930, 49963, 49967,
       49997]
test_inds = np.arange(10000)

home_dir = '/data/gilad/logs/influence/cifar10/log_080419_b_125_wd_0.0004_mom_lr_0.1_f_0.9_p_3_c_2_val_size_1000/test'
for i in test_inds:
    adv_dir = os.path.join(home_dir, 'test_index_{}'.format(i), 'adv')
    fgsm_dir = os.path.join(adv_dir, 'fgsm')
    if os.path.exists(fgsm_dir):
        os.chdir(adv_dir)
        run_cmd('mv fgsm fgsm_targeted')

